<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Advanced Network Analysis</title>
    <meta charset="utf-8" />
    <meta name="author" content="Olga Chyzh [www.olgachyzh.com]" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/default-fonts.css" rel="stylesheet" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Advanced Network Analysis
## Stochastic Actor-Oriented Models
### Olga Chyzh [www.olgachyzh.com]

---


exclude: true



## Readings 

- Christian Steglich, Tom AB Snijders, and Michael Pearson. Dynamic networks and behavior: Separating selection from in
uence. Sociological Methodology, 40(1):329--393, 2010.

---

# SAOM

Stochastic actor oriented model developed primarily by [Snijders](https://www.stats.ox.ac.uk/~snijders/) is implemented in the RSiena package on CRAN: 
- [https://www.stats.ox.ac.uk/~snijders/siena/](https://www.stats.ox.ac.uk/~snijders/siena/)
- [Recent overview piece by Snijders](https://www.annualreviews.org/doi/10.1146/annurev-statistics-060116-054035)

&lt;img src="images/siena.png" width="500px" style="display: block; margin: auto;" /&gt;

---

## SAOM Assumptions

- Actors control their outgoing ties and have full knowledge of the broader network

- Changes in network ties and actor behavior happen in continuous time

- Continuous time is modeled as a series of microsteps

- During a microstep, a randomly chosen actor can change only one of its ties or the value of its behavior variable

- Tie change only depends on the present network

---

## SAOM Broadstrokes

- The simulation starts out at the network observed at the first time point `\(t_{0}\)`

    - Examples: students in the same school

- An actor is chosen randomly using a &lt;span style="background-color: #d0d1e6"&gt;rate function&lt;/span&gt;

- The identified actor gets the opportunity to set a micro step. The actor's choice is determined by their &lt;span style="background-color: #d0d1e6"&gt;objective function&lt;/span&gt;

- Model time is updated and simulation proceeds at step 2

- The simulation terminates once modified network resembles network at `\(t_{1}\)`


---
&lt;img src="images/steglitchetal_table1.png" width="700px" style="display: block; margin: auto;" /&gt;

---

## Rate Functions

- *Micro steps* are opportunities for a randomly chosen actor to change one of his/her  outgoing ties or behavior.

- The frequency of these opportunities for change is modeled using *rate functions,* one for each type of change (network, behavior).

- Waiting time between steps follows an exponential distribution with parameter `\(\lambda_{t} N\)` ( `\(N\)` refers to number of actors in the network)

	+ Values of `\(\lambda_{t}\)` are estimated by calculating the number of edge differences between networks: 

	+ The higher `\(\lambda_{t}\)` is the greater the number of changes between observation moments 

- Probability that an actor `\(i\)` has the opportunity to make a change is equal to `\(1/N\)`

---

## Actor's Objective Function

- Micro steps can be of two kinds: those that involve network changes or behavior changes

- For network changes, the micro step consists of the change of one tie by a given actor.

- Suppose **x** is the current network, and actor **i** has an opportunity to make a network change.

- The next network `\(\textbf{x}^\prime\)` then must either equal to **x** or deviate from **x** by just one row element.

- Hence, there are **N** possible outcomes, and **i** chooses the one that maximizes his/her utility function, called *objective function,* `$$f_i^{net}(\textbf{x},\textbf{x}\prime,\textbf{z})+\epsilon_i^{net}(\textbf{x},\textbf{x}\prime,\textbf{z}),$$`

    - where **z** is the current vector of behavior scores, `\(f^{net}\)` is a measure of actor's satisfaction with the result of the network decision, and `\(\epsilon^{net}\)` is the random component. 

---

## Multinomial Choice Model

- The choice probabilities can be expressed in multinomial logit shape:

&lt;img src="images/saom_choice.png" width="500px" style="display: block; margin: auto;" /&gt;

- where the sum in the denominator extends over all possible next network states `\(\textbf{x}^{\prime\prime}\)` 
---
## Behavior Micro Steps

- A given actor increments or decrements his score on the behavioral variable by one unit, provided that this change does not step outside the range of this variable. The score can also stay the same.

- Let **z** denote the current vector of behavior scores for all actors, and `\(\textbf{z}^\prime\)` is the vector resulting from the actor's action in the micro step.

- Actor **i** makes the choice by maximizing their *behavior objective function*, `$$f_i^{beh}(\textbf{x},\textbf{z},\textbf{z}^\prime)+\epsilon_i^{beh}(\textbf{x},\textbf{z},\textbf{z}^\prime),$$`

    - where `\(f_i^{beh}\)` models the actor's satisfaction with the result of the behavior decision, and `\(\epsilon^{beh}\)` is the random error.
    
- The behavior choice probability can be expressed as:

&lt;img src="images/saom_choice_beh.png" width="500px" style="display: block; margin: auto;" /&gt;

---

## Parameterization

For network changes, the objective function has the general shape `$$f_i^{net}(\textbf{x},\textbf{x}^\prime,\textbf{z})=\sum_h{\beta_h^{net}\textbf{s}_h^{net}(i,\textbf{x},\textbf{x}^\prime,z)},$$`

  - where statistics `\(s_h^{net}\)` are the effects, weighted by parameters `\(\beta_h^{net}\)`.

For behavior changes:

`$$f_i^{beh}(\textbf{x},\textbf{z},\textbf{z}^\prime)=\sum_h\beta_h^{beh}s_h^{beh}(\textbf{i},\textbf{x},\textbf{z},\textbf{z}^\prime),$$`

- Can specify exogenous and endogenous (network) effects.

---

## Estimation

- A stochastic simulation algorithm that generates network and behavioral data according to the postulated dynamic process.

- Start with some network--behavior configuration, **x**(t), **z**(t).

- Draw a waiting time and increment the parameter **t** by this waiting time.

- Determine whether the next event is a network or a behavior change and select an actor who is making this change.

- Determine the action of the selected actor.

- Iterate until the end of the period is reached and evaluate the resulting simulated network--behavior configuration.

---

## Example: Friendship Networks


```r
library(RSiena)
	friend.data.w1 &lt;- s501
	friend.data.w2 &lt;- s502
	friend.data.w3 &lt;- s503
	drink &lt;- s50a
	smoke &lt;- s50s
```

---

## Specify the Network DV:


```r
friendship &lt;- sienaDependent(
                     array( c( friend.data.w1, friend.data.w2, friend.data.w3 ),
                     dim = c( 50, 50, 3 ) ) )
```

.pull-left[

```r
friendship
```

```
## Type         oneMode             
## Observations 3                   
## Nodeset      Actors (50 elements)
```

```r
class(friendship)
```

```
## [1] "sienaDependent"
```

```r
dim( friendship)
```

```
## [1] 50 50  3
```
]

.pull-right[

```r
attributes(friendship)
```

```
## $dim
## [1] 50 50  3
## 
## $class
## [1] "sienaDependent"
## 
## $type
## [1] "oneMode"
## 
## $sparse
## [1] FALSE
## 
## $nodeSet
## [1] "Actors"
## 
## $netdims
## [1] 50 50  3
## 
## $allowOnly
## [1] TRUE
```
]

---

## Specify the Behavior DV:


```r
drinkingbeh &lt;- sienaDependent( drink, type = "behavior" )
drinkingbeh
```

```
## Type         behavior            
## Observations 3                   
## Nodeset      Actors (50 elements)
```

---

## Specify IVs:


```r
smoke1 &lt;- coCovar( smoke[ , 1 ] )

# Put the variables together in the data set for analysis
NBdata &lt;- sienaDataCreate( friendship, smoke1, drinkingbeh)
NBdata                          
```

```
## Dependent variables:  friendship, drinkingbeh 
## Number of observations: 3 
## 
## Nodeset                  Actors 
## Number of nodes              50 
## 
## Dependent variable friendship      
## Type               oneMode         
## Observations       3               
## Nodeset            Actors          
## Densities          0.046 0.047 0.05
## 
## Dependent variable drinkingbeh
## Type               behavior   
## Observations       3          
## Nodeset            Actors     
## Range              1 - 5      
## 
## Constant covariates:  smoke1
```


---
## Possible Types of IVs

- `coCovar`--constant node-level covariate (does not change between time periods)

- `varCovar`--time-variable node-level covariate

- `coDyadCovar`--constant edge-level covariate

- `varDyadCovar`--time-varying edge-level covariate

- `sienaCompositionChange`--over time changes in node set (e.g., some actors leave the network)


```r
?coCovar
```


---

## Specify Endogenous Effects

```r
NBeff &lt;- getEffects( NBdata )
NBeff
```

```
##   name        effectName                          include fix   test 
## 1 friendship  constant friendship rate (period 1) TRUE    FALSE FALSE
## 2 friendship  constant friendship rate (period 2) TRUE    FALSE FALSE
## 3 friendship  outdegree (density)                 TRUE    FALSE FALSE
## 4 friendship  reciprocity                         TRUE    FALSE FALSE
## 5 drinkingbeh rate drinkingbeh (period 1)         TRUE    FALSE FALSE
## 6 drinkingbeh rate drinkingbeh (period 2)         TRUE    FALSE FALSE
## 7 drinkingbeh drinkingbeh linear shape            TRUE    FALSE FALSE
## 8 drinkingbeh drinkingbeh quadratic shape         TRUE    FALSE FALSE
##   initialValue parm
## 1    4.69604   0   
## 2    4.32885   0   
## 3   -1.46770   0   
## 4    0.00000   0   
## 5    0.70571   0   
## 6    0.84939   0   
## 7    0.32237   0   
## 8    0.00000   0
```

---

## Effects Description

```r
effectsDocumentation(NBeff)
```


&lt;img src="images/effects.png" width="500px" style="display: block; margin: auto;" /&gt;

---

## Specify Effects


```r
NBeff &lt;- includeEffects( NBeff, transTrip, transRecTrip )
```

```
##   effectName                  include fix   test  initialValue parm
## 1 transitive triplets         TRUE    FALSE FALSE          0   0   
## 2 transitive recipr. triplets TRUE    FALSE FALSE          0   0
```

```r
NBeff &lt;- includeEffects( NBeff, egoX,  altX, altSqX, diffSqX,
                         interaction1 = "smoke1"  )
```

```
##   effectName           include fix   test  initialValue parm
## 1 smoke1 alter         TRUE    FALSE FALSE          0   0   
## 2 smoke1 squared alter TRUE    FALSE FALSE          0   0   
## 3 smoke1 ego           TRUE    FALSE FALSE          0   0   
## 4 smoke1 diff. squared TRUE    FALSE FALSE          0   0
```

```r
NBeff
```

```
##    name        effectName                          include fix   test 
## 1  friendship  constant friendship rate (period 1) TRUE    FALSE FALSE
## 2  friendship  constant friendship rate (period 2) TRUE    FALSE FALSE
## 3  friendship  outdegree (density)                 TRUE    FALSE FALSE
## 4  friendship  reciprocity                         TRUE    FALSE FALSE
## 5  friendship  transitive triplets                 TRUE    FALSE FALSE
## 6  friendship  transitive recipr. triplets         TRUE    FALSE FALSE
## 7  friendship  smoke1 alter                        TRUE    FALSE FALSE
## 8  friendship  smoke1 squared alter                TRUE    FALSE FALSE
## 9  friendship  smoke1 ego                          TRUE    FALSE FALSE
## 10 friendship  smoke1 diff. squared                TRUE    FALSE FALSE
## 11 drinkingbeh rate drinkingbeh (period 1)         TRUE    FALSE FALSE
## 12 drinkingbeh rate drinkingbeh (period 2)         TRUE    FALSE FALSE
## 13 drinkingbeh drinkingbeh linear shape            TRUE    FALSE FALSE
## 14 drinkingbeh drinkingbeh quadratic shape         TRUE    FALSE FALSE
##    initialValue parm
## 1     4.69604   0   
## 2     4.32885   0   
## 3    -1.46770   0   
## 4     0.00000   0   
## 5     0.00000   0   
## 6     0.00000   0   
## 7     0.00000   0   
## 8     0.00000   0   
## 9     0.00000   0   
## 10    0.00000   0   
## 11    0.70571   0   
## 12    0.84939   0   
## 13    0.32237   0   
## 14    0.00000   0
```

---

## Define the Model:

```r
myalgorithm1 &lt;- sienaAlgorithmCreate( projname = 's50_NB' )

# Estimate using the second algorithm right from the start.
NBans &lt;- siena07(myalgorithm1, data = NBdata, effects = NBeff)
NBans &lt;- siena07(myalgorithm1, data = NBdata, effects = NBeff, batch=TRUE) #without Siena screen
```



---

## Look at results


```r
NBans
```

```
## Estimates, standard errors and convergence t-ratios
## 
##                                                Estimate   Standard   Convergence 
##                                                             Error      t-ratio   
## Network Dynamics 
##    1. rate constant friendship rate (period 1)  6.2738  ( 1.2186   )    0.0384   
##    2. rate constant friendship rate (period 2)  5.0845  ( 0.8572   )   -0.0337   
##    3. eval outdegree (density)                 -2.6246  ( 0.2222   )    0.0538   
##    4. eval reciprocity                          2.7737  ( 0.2664   )    0.0710   
##    5. eval transitive triplets                  0.8915  ( 0.1360   )    0.1005   
##    6. eval transitive recipr. triplets         -0.5130  ( 0.2160   )    0.1082   
##    7. eval smoke1 alter                         0.2548  ( 0.2914   )   -0.0221   
##    8. eval smoke1 squared alter                -0.2197  ( 0.2489   )    0.0047   
##    9. eval smoke1 ego                           0.0873  ( 0.3034   )    0.0015   
##   10. eval smoke1 squared ego                   0.0104  ( 0.2501   )    0.0322   
##   11. eval smoke1 diff. squared                -0.0981  ( 0.0679   )   -0.0047   
## 
## Behavior Dynamics
##   12. rate rate drinkingbeh (period 1)          1.1712  ( 0.3042   )   -0.0364   
##   13. rate rate drinkingbeh (period 2)          1.6518  ( 0.4074   )    0.0249   
##   14. eval drinkingbeh linear shape             0.3664  ( 0.1425   )    0.0079   
##   15. eval drinkingbeh quadratic shape         -0.2053  ( 0.0962   )   -0.0834   
## 
## Overall maximum convergence ratio:    0.1885 
## 
## 
## Total of 3435 iteration steps.
```


---
## Interpretation of Parameters

- The parameters on the rate functions are interpreted as related to the speed of the evolution process. These parameters reflect the frequencies of the opportunities for change. 

- The parameters on the objective functions may be interpreted in terms of their direction and statistical significance or by calculating predicted probabilities of ties in hypothetical scenarios (i.e., use the reverse logistic transformation).

- The linear and the quadratic shape parameters of the behavior objective function model the shape of the long-term distribution of the behavior variable.

- Can also use the reverse logit transformation to interpret the parameters on the behavior effects. 
---
## Example

Suppose we estimated the following model:

`$$f_i^{net}=-2\sum_j\textbf{x}_{ij}^\prime+2.5\sum_j{\textbf{x}_{ij}^\prime\textbf{x}_{ji}+1\sum_j\textbf{x}_{ij}^\prime\text{sim}_ij}$$`

and
`$$f_i^{beh}(\textbf{x},\textbf{z},\textbf{z}^\prime)=-1(\textbf{z}_i^\prime-\textbf{z})-.5(\textbf{z}_i^\prime-\textbf{z})^2+2.5(\sum_j\textbf{x}_{ij}\text{sim}^\prime_{ij})/(\sum_jx_{ij})$$`

The primes indicate the elements in the formulae that are under control of actor **i** and may be changed in a micro step.

- Note that the network objective function contains outdegree, reciprocity, and the similarity effect, and the behavior function includes the linear and quadratic shape of the distribution of the behavior variable and an effect of average similarity to neighbors. 
---
## Interpretation of Parameters: Network Function 

- The parameter estimate of -2 on the outdegree tells us that, if we ignore all other variables, the baseline probability of a tie in this network is `\(\exp{(-2)}/(1+\exp{(-2)})=0.12\)`.

- The parameter estimate of 2.5 on the reciprocity tells us that the probability of a reciprocated tie is `\(\exp{(-2+2.5)}/(1+\exp{(-2+2.5)})=0.62\)`.

- The positive similarity effect indicates that actors tend to form ties with similar others rather than to dissimilar ones. The probability of a tie to a maximally similar actor is `\(\exp{(-2+1)}/(1+\exp{(-2+1)})=0.26\)` vs that of the baseline probability of `\(0.12\)`.

---
## Interpretation of Parameters: Behavior Function 

- Suppose our behavior variable ranges from 1 to 5 and has an average of 3. When mean centered, this variable then ranges from -2 to 2. 

- The first two parameters define a parabolic shape. We can calculate the inflection point of this parabola by solving `\(-1-0.5*2x=0\)` for x. The result is x=-1, which corresponds to the value of 2 on the original scale of this variable. This means that in the long run, the distribution of the behavior variable is unimodal with a maximum at score value 2.

- Can also calculate the probability of moving from one score to the other. For example, the probability of moving from 3 to 2 is `$$\begin{align}\exp&amp;(-1(2-3)-0.5(2-3)^2)/(1+\exp(-1(2-3)-0.5(2-3)^2))\\&amp;=0.62\end{align}$$` The probability of staying at 3 rather than moving to 2 is 1-0.62=0.38.


---
## Interpretation of Parameters: Behavior Function Cont'd
- The third parameter of 2.5 on the average similarity indicates that actors tend to act in the same manner as their friends. 

- Consider an actor with a 3 on their behavior and assume he has five friends, four of whom score 3 and 1 scoring 2 or lower. 

- If this actor moves to 2, his average similarity to four of his friends will decrease by -1*4 and his similarity to his fifth friend will increase by 1. 

- The average similarity will decrease from 1/5 to 4/5 for a change of -0.6. Then, accounting for the similarity effect, the probability of moving from 3 to 2 for this actor is `$$\begin{align}&amp;\exp(-1(2-3)-0.5(2-3)^2\\&amp;+2.5(-0.6))/(1+\exp(-1(2-3)-0.5(2-3)^2\\&amp;+2.5(-0.6))=0.26\end{align}$$` 

---
## Your Turn

Use the example above to answer the following questions.

- What is the probability of reciprocating an incoming tie to a similar actor? 

- What is the probability of moving from 3 to 4, ignoring the similarity to friends?

- Suppose an actor has 5 friends, 3 of whom score 4 and 2 of whom score 3. What is the probability of moving from 3 to 4, if we account for homophily?


---

## Back to Our Estimated Model


```r
NBans
```

```
## Estimates, standard errors and convergence t-ratios
## 
##                                                Estimate   Standard   Convergence 
##                                                             Error      t-ratio   
## Network Dynamics 
##    1. rate constant friendship rate (period 1)  6.2738  ( 1.2186   )    0.0384   
##    2. rate constant friendship rate (period 2)  5.0845  ( 0.8572   )   -0.0337   
##    3. eval outdegree (density)                 -2.6246  ( 0.2222   )    0.0538   
##    4. eval reciprocity                          2.7737  ( 0.2664   )    0.0710   
##    5. eval transitive triplets                  0.8915  ( 0.1360   )    0.1005   
##    6. eval transitive recipr. triplets         -0.5130  ( 0.2160   )    0.1082   
##    7. eval smoke1 alter                         0.2548  ( 0.2914   )   -0.0221   
##    8. eval smoke1 squared alter                -0.2197  ( 0.2489   )    0.0047   
##    9. eval smoke1 ego                           0.0873  ( 0.3034   )    0.0015   
##   10. eval smoke1 squared ego                   0.0104  ( 0.2501   )    0.0322   
##   11. eval smoke1 diff. squared                -0.0981  ( 0.0679   )   -0.0047   
## 
## Behavior Dynamics
##   12. rate rate drinkingbeh (period 1)          1.1712  ( 0.3042   )   -0.0364   
##   13. rate rate drinkingbeh (period 2)          1.6518  ( 0.4074   )    0.0249   
##   14. eval drinkingbeh linear shape             0.3664  ( 0.1425   )    0.0079   
##   15. eval drinkingbeh quadratic shape         -0.2053  ( 0.0962   )   -0.0834   
## 
## Overall maximum convergence ratio:    0.1885 
## 
## 
## Total of 3435 iteration steps.
```

---

## Let's Specify a Model That...

1. accounts for homophily effect for smoking



```r
NBeff &lt;- getEffects( NBdata )

NBeff &lt;- includeEffects(NBeff, simX,
          interaction1 = "smoke1" )
```

```
##   effectName        include fix   test  initialValue parm
## 1 smoke1 similarity TRUE    FALSE FALSE          0   0
```

---

## Let's Specify a Model That...

2. Parses out whether there is a selection or influence (or both) effect for drinking behavior--- include sender, receiver and homophily effects of drinking for friendship formation, and vice versa.


```r
NBeff &lt;- includeEffects(NBeff, egoX, altX, simX,
           interaction1 = "drinkingbeh" )
```

```
##   effectName             include fix   test  initialValue parm
## 1 drinkingbeh alter      TRUE    FALSE FALSE          0   0   
## 2 drinkingbeh ego        TRUE    FALSE FALSE          0   0   
## 3 drinkingbeh similarity TRUE    FALSE FALSE          0   0
```

```r
NBeff &lt;- includeEffects(NBeff, name = "drinkingbeh",
      avAlt,indeg,outdeg,
      interaction1 = "friendship" )
```

```
##   effectName                include fix   test  initialValue parm
## 1 drinkingbeh indegree      TRUE    FALSE FALSE          0   0   
## 2 drinkingbeh outdegree     TRUE    FALSE FALSE          0   0   
## 3 drinkingbeh average alter TRUE    FALSE FALSE          0   0
```

---
## Your Turn

1. Run the new model

2. What is the probability of a reciprocated tie?

3. What is the probability of a reciprocated tie for two actors with the same drinking habits?

4. What is the range of the drinking variable? What is it's mean?  What is the inflection point in the parabola that is fitted to the trend in drinking behavior? 

5. What is the probability of someone moving from drinking=3 to drinking=2, without accounting for homophily?

6. Suppose an individual has 2 friends, one with a drink score of 5 and another with a drink score of 2. What is the probability that this individual will move from drinking=3 to drinking=2, accounting for homophily?


---
## Results

```r
m2&lt;-readRDS("data/m2.rds")
summary(m2)
```

```
## Estimates, standard errors and convergence t-ratios
## 
##                                                Estimate   Standard   Convergence 
##                                                             Error      t-ratio   
## Network Dynamics 
##    1. rate constant friendship rate (period 1)  5.7922  ( 0.9928   )   -0.0571   
##    2. rate constant friendship rate (period 2)  4.4682  ( 0.7841   )    0.0021   
##    3. eval outdegree (density)                 -2.4480  ( 0.1227   )    0.0378   
##    4. eval reciprocity                          2.7889  ( 0.1979   )    0.0030   
##    5. eval smoke1 similarity                    0.3039  ( 0.2023   )    0.0253   
##    6. eval drinkingbeh alter                   -0.0090  ( 0.0989   )   -0.0381   
##    7. eval drinkingbeh ego                      0.1187  ( 0.1095   )    0.0273   
##    8. eval drinkingbeh similarity               1.2253  ( 0.5841   )    0.0242   
## 
## Behavior Dynamics
##    9. rate rate drinkingbeh (period 1)          1.2026  ( 0.3032   )    0.0745   
##   10. rate rate drinkingbeh (period 2)          1.6445  ( 0.4092   )   -0.0031   
##   11. eval drinkingbeh linear shape             0.3657  ( 0.1410   )    0.0354   
##   12. eval drinkingbeh quadratic shape         -0.1977  ( 0.0868   )    0.0298   
## 
## Overall maximum convergence ratio:    0.1583 
## 
## 
## Total of 3060 iteration steps.
## 
## Covariance matrix of estimates (correlations below diagonal)
## 
##        0.986        0.000        0.017       -0.002       -0.019        0.016       -0.018       -0.146        0.012        0.015        0.003        0.001
##        0.000        0.615        0.005       -0.012        0.016        0.005       -0.007       -0.053        0.001       -0.020        0.002       -0.004
##        0.137        0.057        0.015       -0.015       -0.002        0.003       -0.003       -0.036        0.000        0.003        0.001        0.000
##       -0.013       -0.078       -0.629        0.039       -0.005       -0.003        0.002        0.002        0.004       -0.006       -0.001        0.000
##       -0.097        0.101       -0.079       -0.122        0.041        0.002        0.006       -0.002        0.002        0.003       -0.001        0.000
##        0.159        0.062        0.222       -0.168        0.117        0.010       -0.005       -0.012        0.002        0.003       -0.001        0.000
##       -0.161       -0.084       -0.222        0.090        0.279       -0.479        0.012        0.009        0.002       -0.001        0.000        0.000
##       -0.252       -0.116       -0.498        0.015       -0.020       -0.204        0.145        0.341       -0.010       -0.013       -0.001       -0.002
##        0.039        0.004       -0.004        0.059        0.038        0.058        0.059       -0.059        0.092        0.007       -0.011        0.004
##        0.037       -0.062        0.061       -0.070        0.031        0.067       -0.016       -0.052        0.055        0.167       -0.012        0.007
##        0.023        0.020        0.060       -0.049       -0.026       -0.050        0.002       -0.014       -0.249       -0.215        0.020       -0.002
##        0.008       -0.061        0.034       -0.021       -0.005       -0.002        0.034       -0.041        0.136        0.185       -0.144        0.008
## 
## Derivative matrix of expected statistics X by parameters:
## 
##        9.899        0.000        1.123        0.799        0.364       -1.424       -0.392        0.355       -0.417        0.000       -0.422       -0.802
##        0.000       10.785        2.198        1.614       -0.772        0.679        0.423       -0.010        0.000        0.234        0.209        1.436
##       25.177       18.912      202.582      155.097       18.963      -28.942      -22.184       17.817       -1.843       -0.007        0.296       -3.053
##        0.828        3.312       88.171      105.556       10.242       -8.759      -12.631        8.843       -1.395        0.404        1.356        0.024
##        4.613        0.247       22.669       20.514       32.130      -33.974      -34.460        4.881       -0.758        0.358        0.943       -1.140
##       -9.913        2.175        1.179       10.182      -19.665      186.499      102.977        0.200        1.541       -5.957        0.465        1.544
##       -1.934       10.752        7.571        0.254      -25.886      111.052      170.435       -2.222       -1.661       -3.351       -3.787       -3.528
##        5.533        3.657       21.389       16.615        1.785        0.744       -0.784        7.476        0.536        0.445        0.683        0.029
##        2.686        0.000        0.673       -0.699       -0.752       -4.899       -4.503       -1.904       15.674        0.000        9.055       -1.704
##        0.000        0.627        2.058        2.308        0.038        0.759        0.670       -0.979        0.000       12.240        5.942       -1.845
##        2.157        1.063        9.298        8.959       -0.636        6.995        4.125        0.988        7.115        5.830       58.962       14.699
##       -3.979       -3.768      -21.247      -11.615       -2.522       12.590       13.923        4.364       -2.154       -6.526        3.909      142.171
## 
## Covariance matrix of X (correlations below diagonal):
## 
##       96.131        1.019       30.704       10.438        3.351      -16.391      -17.781        1.869        0.920        1.446        3.223      -10.198
##        0.012       72.006       25.185        8.712        0.272        1.843        1.418        1.223        0.468        0.178        3.136        0.030
##        0.213        0.202      216.213      175.756       23.554      -28.431      -31.466       18.372        0.587        2.320       14.852      -22.973
##        0.076        0.073        0.853      196.287       20.637      -19.118      -31.147       16.451       -0.150        1.310       11.340      -14.380
##        0.060        0.006        0.280        0.257       32.732      -35.396      -38.751        4.148       -1.706        0.911        0.076       -5.049
##       -0.108        0.014       -0.125       -0.088       -0.399      240.443      163.802       -1.421        1.201       -3.356        3.542       14.546
##       -0.118        0.011       -0.139       -0.144       -0.440        0.687      236.721       -0.601       -0.613       -2.608        0.463       15.845
##        0.053        0.040        0.348        0.327        0.202       -0.026       -0.011       12.892       -1.866       -1.633        0.454        2.255
##        0.020        0.012        0.009       -0.002       -0.065        0.017       -0.009       -0.114       20.960       -0.497       10.950        1.236
##        0.031        0.004        0.033        0.019        0.033       -0.045       -0.035       -0.094       -0.023       23.240        9.921       -1.491
##        0.042        0.047        0.128        0.102        0.002        0.029        0.004        0.016        0.302        0.260       62.596       12.656
##       -0.086        0.000       -0.129       -0.085       -0.073        0.078        0.085        0.052        0.022       -0.026        0.132      146.122
```



---
## Convergence Ratios

- Note that the "convergence t-ratio" is the t-ratio for convergence checking, not the t statistic for testing the significance of this effect (See Section 6.3 of the RSiena manual).

- For good convergence, the t-ratios for convergence all should be less than .1 in absolute value, and the overall maximum convergence ratio should be less than 0.25.

- If this is not yet the case, you should try again, starting from the last estimate as the previous answer (`prevAns` argument), e.g.:


```r
m3 &lt;- siena07(myalgorithm2, data = NBdata,
      effects = NBeff, prevAns = m2 )
```
---
## Goodness of Fit: Indegree

- Can plot distributions of network statistics from simulated networks

- Note: must specify `returnDeps=TRUE` in the `siena07` function to save these networks.


```r
myalgorithm2 &lt;- sienaAlgorithmCreate(projname = 's50CoEv_2' )
m2 &lt;- siena07(myalgorithm2, data = NBdata,
      effects = NBeff, batch=TRUE, returnDeps=TRUE) 
gofI &lt;- sienaGOF(m2, IndegreeDistribution, verbose=TRUE, join=TRUE,
     varName="friendship")
plot(gofI)
saveRDS(gofI,"data/gofI")
```

---
## Goodness of Fit: Indegree
&lt;img src="12_soam_files/figure-html/unnamed-chunk-26-1.png" style="display: block; margin: auto;" /&gt;


---
## Goodness of Fit: Outdegree

```r
gofO &lt;- sienaGOF(m2, OutdegreeDistribution, verbose=TRUE, join=TRUE,
     varName="friendship")
plot(gofO)
saveRDS(gofO,"data/gofO")
```


&lt;img src="12_soam_files/figure-html/unnamed-chunk-28-1.png" width="400px" style="display: block; margin: auto;" /&gt;

---
## Goodness of Fit: Triad Census

```r
gofTC &lt;- sienaGOF(m2, TriadCensus, verbose=TRUE, join=TRUE,
     varName="friendship")
plot(gofTC)
saveRDS(gofTC,"data/gofTC")
```

&lt;img src="12_soam_files/figure-html/unnamed-chunk-30-1.png" width="400px" style="display: block; margin: auto;" /&gt;




---

## Actors Entering and Exiting the Network

- Treatment by structural zero coding

- Treatment by composition change directives

- What to use?

- Loosely related to structural zeros: structural ones

---

## Treatment by structural zero coding
- When actors are not part of the group at a given measurement point, code their outgoing and incoming ties as “10”,
meaning “absent, and could not possibly have been present”.

- When running simulations, this is handled as follows:

  - A tie value “10” at the beginning of a period implies that the tie will remain structurally absent throughout the period, no matter what the tie’s value at the end of the period is.
   - A tie value “10” at the end of a period implies that no matter what the tie’s simulated value at the end of the period is, it is overwritten by “10” before any statistics are evaluated.

- See RSiena manual section 4.1.2.

---
## Treatment by structural zero coding

- When information is known about the exact time when actors left or entered the group in continuous time between observation moments, this information can be made use of.

- In simulations, joiners enter at the indicated time point and then are simultaneously connected to the rest of the actors
according to the data provided for the period begin (so, they do not necessarily have to ‘start from scratch’ but can inherit ties!)

- Leavers just exit and cannot change their ties any more from this time point on; their last connection data can be provided for the period end.

- Joiner and leaver data need to be provided in an additional
file; see RSiena manual sections 2.1.2 and 4.7.

---
## What to Use

- Composition change directives allow to make use of more information. If information is scarce, this may be
the better option.

-  Structural zero treatment is quite crude, if results can be obtained this way, they will likely be robust. But under
scarce information conditions, it can happen that no results can be obtained.


---

## Structural Ones

- Sometimes, ties can be “present, and could not possibly have been absent”.
    - Studying a communication network among employees, where Loosely related to structural zeros:

    - Studying a communication network among employees, where some people are forced to communicate anyway (by their job
contract).

- Studying a growing network where ties once formed cannot be dissolved again.

- In such situations, tie variables can be coded as “11”.

- See RSiena manual section 4.1.2.
---
## Example: Duque Data


```r
library(devtools)
#install_github("ochyzh/networkdata")
data("duqueData")
dim(dipl_ties[[1]])
```

```
## [1] 134 134
```

```r
dim(dipl_ties[[2]])
```

```
## [1] 148 148
```

- Remember that in these data, time periods have varying numbers of observations, as states enter and leave the system.

- In order to use RSiena, we must have the same number of actors in each time period. If an actor is missing, their tie values are coded using the structural zero code `10`. Alternatively, you can provide an additional file that details when actors enter and leave the data.

 

---

## Example: Duque Data


```r
library(tidyverse)
#get the full list of actors:
myactors&lt;-unique(do.call("c",lapply(dipl_ties,names)))
dyads&lt;-expand.grid(myactors,myactors)

dipl&lt;-array(10, dim = c( 194, 194, 3 ),
	dimnames=list(myactors,myactors,seq(from=1970,to=1980,by=5)))

for(t in 1:3){
    d&lt;-dipl_ties[[t]]
	for(i in 1:nrow(d)){
	  for (j in 1:ncol(d)){
		a1 = names(d)[i]
		a2 = colnames(d)[j]
		val = as.numeric(as.character(d[i,j]))
		
		dipl[i,j,t] &lt;- val
		dipl[j,i,t] &lt;- val
	  }}
	}

dipl &lt;- sienaDependent(dipl)
```


---

## Your Turn

1. Set up `allies` and `contig` as edge-level covariates (use the first three time periods).

2. Set up `polity` as a time-varying node-level covariate (use the first three time periods).

3. Estimate a model that includes the following covariates: outdegree, reciprocity, transitive triplets, polity alter, polity ego, polity diff., contiguity, and allies.







---

# TERGM vs. SAOM

- [Block et al. 2017](http://journals.sagepub.com/doi/abs/10.1177/0049124116672680)
- [Block et al. 2018](https://www.sciencedirect.com/science/article/pii/S0378873317300035)
- [Leifeld &amp; Cranmer 2018](https://arxiv.org/pdf/1506.06696.pdf)



    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
